{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { Callable } from \"@renproject/utils\";\nimport axios from \"axios\";\nimport { sortUTXOs, DEFAULT_TIMEOUT } from \"./API\";\nexport class BlockstreamClass {\n  constructor({\n    testnet = false,\n    apiKey = undefined\n  } = {}) {\n    this.getAPIUrl = path => `https://blockstream.info/${this.testnet ? \"testnet/\" : \"\"}api${path}${this.apiKey ? `?key=${this.apiKey}` : \"\"}`;\n\n    this.fetchUTXO = (txHash, vOut) => __awaiter(this, void 0, void 0, function* () {\n      const utxo = (yield axios.get(this.getAPIUrl(`/tx/${txHash}`), {\n        timeout: DEFAULT_TIMEOUT\n      })).data;\n      const heightResponse = (yield axios.get(this.getAPIUrl(`/blocks/tip/height`), {\n        timeout: DEFAULT_TIMEOUT\n      })).data;\n      const confirmations = utxo.status.confirmed ? Math.max(1 + parseInt(heightResponse, 10) - utxo.status.block_height, 0) : 0;\n      return {\n        txHash,\n        amount: utxo.vout[vOut].value.toString(),\n        vOut,\n        confirmations\n      };\n    });\n\n    this.fetchUTXOs = (address, confirmations = 0) => __awaiter(this, void 0, void 0, function* () {\n      const response = yield axios.get(this.getAPIUrl(`/address/${address}/utxo`), {\n        timeout: DEFAULT_TIMEOUT\n      });\n      const heightResponse = yield axios.get(this.getAPIUrl(`/blocks/tip/height`), {\n        timeout: DEFAULT_TIMEOUT\n      });\n      return response.data.map(utxo => ({\n        txHash: utxo.txid,\n        amount: utxo.value.toString(),\n        vOut: utxo.vout,\n        confirmations: utxo.status.confirmed ? 1 + parseInt(heightResponse.data, 10) - utxo.status.block_height : 0\n      })).filter(utxo => confirmations === 0 || utxo.confirmations >= confirmations).sort(sortUTXOs);\n    });\n\n    this.fetchTXs = (address, confirmations = 0) => __awaiter(this, void 0, void 0, function* () {\n      const response = yield axios.get(this.getAPIUrl(`/address/${address}/txs`), {\n        timeout: DEFAULT_TIMEOUT\n      });\n      const heightResponse = yield axios.get(this.getAPIUrl(`/blocks/tip/height`), {\n        timeout: DEFAULT_TIMEOUT\n      });\n      const received = [];\n\n      for (const tx of response.data) {\n        for (let i = 0; i < tx.vout.length; i++) {\n          const vout = tx.vout[i];\n\n          if (vout.scriptpubkey_address === address) {\n            received.push({\n              txHash: tx.txid,\n              amount: vout.value.toString(),\n              vOut: i,\n              confirmations: tx.status.confirmed ? 1 + parseInt(heightResponse.data, 10) - tx.status.block_height : 0\n            });\n          }\n        }\n      }\n\n      return received.filter(utxo => confirmations === 0 || utxo.confirmations >= confirmations).sort(sortUTXOs);\n    });\n\n    this.broadcastTransaction = txHex => __awaiter(this, void 0, void 0, function* () {\n      const response = yield axios.post(this.getAPIUrl(`/tx`), txHex, {\n        timeout: DEFAULT_TIMEOUT\n      });\n      return response.data;\n    });\n\n    this.testnet = testnet;\n    this.apiKey = apiKey;\n  }\n\n}\nexport const Blockstream = Callable(BlockstreamClass);","map":{"version":3,"sources":["../../../src/APIs/blockstream.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { Callable } from \"@renproject/utils\";\nimport axios from \"axios\";\nimport { sortUTXOs, DEFAULT_TIMEOUT } from \"./API\";\nexport class BlockstreamClass {\n    constructor({ testnet = false, apiKey = undefined } = {}) {\n        this.getAPIUrl = (path) => `https://blockstream.info/${this.testnet ? \"testnet/\" : \"\"}api${path}${this.apiKey ? `?key=${this.apiKey}` : \"\"}`;\n        this.fetchUTXO = (txHash, vOut) => __awaiter(this, void 0, void 0, function* () {\n            const utxo = (yield axios.get(this.getAPIUrl(`/tx/${txHash}`), {\n                timeout: DEFAULT_TIMEOUT,\n            })).data;\n            const heightResponse = (yield axios.get(this.getAPIUrl(`/blocks/tip/height`), {\n                timeout: DEFAULT_TIMEOUT,\n            })).data;\n            const confirmations = utxo.status.confirmed\n                ? Math.max(1 + parseInt(heightResponse, 10) - utxo.status.block_height, 0)\n                : 0;\n            return {\n                txHash,\n                amount: utxo.vout[vOut].value.toString(),\n                vOut,\n                confirmations,\n            };\n        });\n        this.fetchUTXOs = (address, confirmations = 0) => __awaiter(this, void 0, void 0, function* () {\n            const response = yield axios.get(this.getAPIUrl(`/address/${address}/utxo`), { timeout: DEFAULT_TIMEOUT });\n            const heightResponse = yield axios.get(this.getAPIUrl(`/blocks/tip/height`), { timeout: DEFAULT_TIMEOUT });\n            return response.data\n                .map((utxo) => ({\n                txHash: utxo.txid,\n                amount: utxo.value.toString(),\n                vOut: utxo.vout,\n                confirmations: utxo.status.confirmed\n                    ? 1 +\n                        parseInt(heightResponse.data, 10) -\n                        utxo.status.block_height\n                    : 0,\n            }))\n                .filter((utxo) => confirmations === 0 || utxo.confirmations >= confirmations)\n                .sort(sortUTXOs);\n        });\n        this.fetchTXs = (address, confirmations = 0) => __awaiter(this, void 0, void 0, function* () {\n            const response = yield axios.get(this.getAPIUrl(`/address/${address}/txs`), { timeout: DEFAULT_TIMEOUT });\n            const heightResponse = yield axios.get(this.getAPIUrl(`/blocks/tip/height`), { timeout: DEFAULT_TIMEOUT });\n            const received = [];\n            for (const tx of response.data) {\n                for (let i = 0; i < tx.vout.length; i++) {\n                    const vout = tx.vout[i];\n                    if (vout.scriptpubkey_address === address) {\n                        received.push({\n                            txHash: tx.txid,\n                            amount: vout.value.toString(),\n                            vOut: i,\n                            confirmations: tx.status.confirmed\n                                ? 1 +\n                                    parseInt(heightResponse.data, 10) -\n                                    tx.status.block_height\n                                : 0,\n                        });\n                    }\n                }\n            }\n            return received\n                .filter((utxo) => confirmations === 0 || utxo.confirmations >= confirmations)\n                .sort(sortUTXOs);\n        });\n        this.broadcastTransaction = (txHex) => __awaiter(this, void 0, void 0, function* () {\n            const response = yield axios.post(this.getAPIUrl(`/tx`), txHex, {\n                timeout: DEFAULT_TIMEOUT,\n            });\n            return response.data;\n        });\n        this.testnet = testnet;\n        this.apiKey = apiKey;\n    }\n}\nexport const Blockstream = Callable(BlockstreamClass);\n//# sourceMappingURL=blockstream.js.map"]},"metadata":{},"sourceType":"module"}